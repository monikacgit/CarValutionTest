package data;

import model.CarInfo;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.*;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class CarDataReader {
    private static final String REGEX_PATTERN = "[A-Z]{2}\\d{2}\\s?[A-Z]{3}";

    // Reads the input file and extracts registration numbers based on a regex pattern
    public List<String> getRegistrationNumbers(String filePath) throws IOException {
        String content = Files.readString(Path.of(filePath));
        List<String> regNumbers = new ArrayList<>();
        
        Matcher matcher = Pattern.compile(REGEX_PATTERN).matcher(content);
        while (matcher.find()) {
            regNumbers.add(matcher.group().replaceAll("\\s+", "")); // Normalize format by removing spaces
        }
        return regNumbers;
    }

    // Reads expected output file, maps car details by registration number
    public Map<String, CarInfo> loadExpectedData(String filePath) throws IOException {
        Map<String, CarInfo> carDataMap = new HashMap<>();

        try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {
            reader.readLine(); // skip header line
            String line;
            while ((line = reader.readLine()) != null) {
                String[] data = line.split(",");
                carDataMap.put(data[0], new CarInfo(data[1], data[2], data[3], data[0]));
            }
        }
        return carDataMap;
    }
}